package provider

// Note:  This file is automatically generated.  Manually made changes
// will be overwritten when the provider is generated.

import (
	"context"
	"fmt"

	"github.com/PaloAltoNetworks/pango"

	"github.com/hashicorp/terraform-plugin-framework/action"
	"github.com/hashicorp/terraform-plugin-framework/action/schema"
	"github.com/hashicorp/terraform-plugin-framework/attr"
	"github.com/hashicorp/terraform-plugin-framework/types"
)

var (
	_ action.ActionWithConfigure = &CommitAllAction{}
)

func NewCommitAllAction() action.Action {
	return &CommitAllAction{}
}

type CommitAllAction struct {
	client *pango.Client
}

type CommitAllActionModel struct {
	DeviceGroups types.List `tfsdk:"device_groups"`
}

func CommitAllActionSchema() schema.Schema {
	return schema.Schema{
		Description: "Pushes committed configuration to managed devices (Panorama only). " +
			"This action does NOT commit pending changes - use panos_commit first to commit changes to Panorama.",
		Attributes: map[string]schema.Attribute{
			"device_groups": schema.ListAttribute{
				Description: "List of device group names to push configuration to. " +
					"If not specified, pushes to all device groups in Panorama. " +
					"Example: [\"Production\", \"DMZ\"]",
				ElementType: types.StringType,
				Optional:    true,
			},
		},
	}
}

func (o *CommitAllActionModel) getTypeFor(name string) attr.Type {
	schema := CommitAllActionSchema()
	if attr, ok := schema.Attributes[name]; !ok {
		panic(fmt.Sprintf("could not resolve schema for attribute %s", name))
	} else {
		switch attr := attr.(type) {
		default:
			return attr.GetType()
		}
	}

	panic("unreachable")
}

func (o *CommitAllAction) Metadata(ctx context.Context, req action.MetadataRequest, resp *action.MetadataResponse) {
	resp.TypeName = req.ProviderTypeName + "_commit_all"
}

func (o *CommitAllAction) Schema(_ context.Context, _ action.SchemaRequest, resp *action.SchemaResponse) {
	resp.Schema = CommitAllActionSchema()
}

func (o *CommitAllAction) Invoke(ctx context.Context, req action.InvokeRequest, resp *action.InvokeResponse) {
	o.InvokeCustom(ctx, req, resp)
}

func (o *CommitAllAction) Configure(ctx context.Context, req action.ConfigureRequest, resp *action.ConfigureResponse) {
	// Prevent panic if the provider has not been configured.
	if req.ProviderData == nil {
		return
	}

	providerData := req.ProviderData.(*ProviderData)
	o.client = providerData.Client
}
